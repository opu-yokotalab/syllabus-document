\documentclass[a4j, 12pt]{jarticle}
% プリアンブル
\usepackage{ascmac}
\usepackage{graphicx}

%%% 表示がおかしいので以下をコメントアウト %%%
%%%% 上下 3cm, 左右 2cm の余白を定義します 　%%%
%\paperwidth	597pt
%\paperheight 	845pt
%\hoffset   	-14.0pt
%\voffset    	14.5pt
%\oddsidemargin	  0.0pt
%\evensidemargin 0.0pt
%\topmargin     0.0pt
%\headheight    0.0pt
%\headsep       0.0pt
%\textheight 	659.0pt 
%% \textheight 	671.0pt 
%\textwidth		80.5pt
%\marginparsep	0.0pt
%\marginparwidth 0.0pt
%\footskip 	1.0cm 

%\renewcommand{\footnoterule}{
%	\vspace{0.5pt}
%	\noindent\rule{\textwidth}{0.4pt}
%	\vspace{-0.5pt}
%}

\begin{document}

% 表紙
\title{岡山県立大学シラバス管理システム2009\\内部設計書}
\author{岡崎　浩和}
\date{\today} % 西暦
\maketitle

% 目次
\newpage
\tableofcontents % 目次作成命令
\newpage

% 本文
\section{本書について}
本書は2009年度のシラバスシステムの内部設計書です。

%% ファイル配置図 ※いらない
%\section{ファイル配置図}
%\begin{figure}[htbp]
%\begin{center}
%\includegraphics[scale=0.33]{Syllabus.eps}
%\caption{ファイル配置図}
%\label{fig:file_list}
%\end{center}
%\end{figure}

% プログラム情報
\section{プログラム情報}\label{sec:program-information}
以下に、シラバスシステムの各種プログラムファイルと機能の概要を示します。

% PHPファイル
\subsection{PHPファイル}\label{sec:php-file}

\subsubsection{index.php}\label{sec:index-php}
ユーザー・ルートユーザーがログインしてない時のトップページです。
教員IDとパスワードが入力され、認証ボタンが押されたならば、
$view\_user\_class.php$ファイルに処理が引き継がれます。

また、教員の新規登録には$regist\_user\_class.php$ファイル、
登録済み科目の一覧には$view\_all\_class.php$ファイルがリンクで呼び出されます。

\begin{itemize}
\item 使用スタイルシート $top.css$
\end{itemize}

\subsubsection{view\_user\_class.php}\label{sec:view-user-class-php}
ユーザー・ルートユーザーの認証管理を行います。
ユーザーがログインしているならば、ユーザーが担当している科目の一覧ページを表示します。
ルートユーザーがログインしているならば、全ての科目一覧ページを表示します。
ログインしていない、もしくは認証に失敗したユーザーにはエラーメッセージと、再度ログインして頂くためにトップページへのリンクを表示します。

\begin{itemize}
\item 使用スタイルシート $SCS.css$
\end{itemize}

\subsubsection{regist\_user.php}\label{sec:regist-user-php}
ユーザーの追加処理を行います。
登録が正常に行われたならば、登録完了のメッセージの表示、科目一覧ページ・トップページへのリンクを表示します。
正常に登録が行われなかったときは、前画面へ戻るリンクを表示します。

\begin{itemize}
\item 使用スタイルシート $maintenance.css$
\end{itemize}

\subsubsection{delete\_user.php}\label{sec:delete-user-php}
ユーザーの削除処理を行います。
削除する際に、ユーザーのxml・pdfファイルも同時に削除するかどうか尋ねます。
正常に削除されたときは、ユーザーはトップページへの、ルートユーザーは全ての科目一覧ページへのリンクを表示します。
教員が選択されてないなど、ユーザーの記入漏れがある際は前画面へ戻るためのリンクを表示します。

\begin{itemize}
\item 使用スタイルシート $maintenance.css$
\end{itemize}

\subsubsection{change\_pass.php}\label{sec:change-pass-php}
ユーザーのパスワードの変更を行います。ルートユーザーはパスワードの変更を行うことが出来ません。（多分）
正常に変更されたときは科目一覧ページへのリンクを表示します。
パスワードが入力されてない、確認のパスワードが一致しない。これら二つのエラーの際には前画面へ戻るためのリンクを表示します。

\begin{itemize}
\item 使用スタイルシート $maintenance.css$
\end{itemize}

\subsubsection{regist\_class.php}\label{sec:regist-class-php}
新しい科目の登録を行います。登録は科目の担当教員が行います。
ルートユーザーが新しい科目を登録するならば、$chown\_class.php$で科目の所有者を変更しないとユーザーは使えません。（多分）
正常に登録されたときは、その科目のpdfファイルの元となるxmlファイルを作成し、科目一覧ページへのリンクを表示します。
登録名が入力されてない場合は、エラーメッセージと、科目一覧ページへ戻るためののリンクを表示します。

\begin{itemize}
\item 使用スタイルシート $maintenance.css$
\end{itemize}

\subsubsection{delete\_class.php}\label{sec:delete-class-php}
科目の削除処理を行います。
削除する際に確認ページを表示します。
正常に削除されたときは、科目一覧ページへのリンクを表示します。

\begin{itemize}
\item 使用スタイルシート $maintenance.css$
\end{itemize}

\subsubsection{edit.php}\label{sec:edit-php}
選択された科目のシラバスの内容を編集します。
正常に内容が変更された場合、対応するxmlファイルを更新し、pdfファイルを新たに生成します。

\begin{itemize}
\item 使用スタイルシート $edit.css$
\end{itemize}

\subsubsection{chown\_class.php}\label{sec:chown-class-php}
選択された科目の所有者を変更します。この変更はルートユーザーのみ行うことが出来ます。

\begin{itemize}
\item 使用スタイルシート $maintenance.css$
\end{itemize}

\subsubsection{view\_all\_class.php}\label{sec:view-all-class-php}
全ての科目のシラバスファイルの状態を確認することができます。
また、既に作成されているpdfファイルにもアクセスすることができます。
この機能は未ログインでも使用できます。

\begin{itemize}
\item 使用スタイルシート $SCS.css$
\end{itemize}

\subsubsection{str2otf.php}\label{sec:str2otf-php}
otfは和文OpenTypeフォントを扱うための$Latex$のパッケージです。
このファイルは、各文字をotfでの$UTF-8$の表示方法である$\backslash UTF????$という形式に変換するための
$str2otf$という関数を定義しています。

% セッションファイル
\subsection{Sessionファイル}\label{sec:session-file}

\subsubsection{session\_start.inc}\label{sec:sesion-start-inc}
セッションを開始します。セッション名はsyllabusです。

\subsubsection{session\_check.inc}\label{sec:session-check-inc}
セッションファイルが作成されてないユーザー（ログインしていないユーザー）は$index.php$にリダイレクトされます。

\subsubsection{session\_end.inc}\label{sec:session-end-inc}
セッションファイルを削除します。セッションファイルと共にクッキーファイルも削除します。

% 設定ファイル
\subsection{設定ファイル}\label{sec:config-file}

\subsubsection{value.inc}\label{sec:value-inc}
各種ファイルで使用される変数を定義しています。定義一覧

\begin{itemize}
\item シラバスシステムのバージョン情報
\item PHPファイル、セッションファイル、パスワードファイルのファイルパス
\item セッションクッキーパス
\item communications = 情報通信工学科　などの実学科名とプログラム中で使用している学科名との対応付け
\end{itemize}

% cssファイル
\subsection{CSSファイル}\label{sec:css-file}
CSSファイルリスト

\begin{itemize}
\item edit.css
\item maintenance.css
\item SCS.css
\item top.css
\item use.css
\end{itemize}

各CSSファイルを使用しているPHPファイルは、\ref{sec:php-file}章に記述しています。

% データファイル構成
\section{データファイル構成}\label{sec:data-file-composition}
本章では、システムがデータの格納や処理を行うファイルとディレクトリの構成について示します。

\subsection{dataディレクトリ}\label{sec:data-dir}
dataディレクトリには実際に作成されたデータが格納されています。

dataディレクトリ以下には各学科毎のディレクトリがあり、各学科のディレクトリの内部はpdfディレクトリ・workdirディレクトリ・xmlディレクトリに分かれています。
各学科名とディレクトリとの対応はvalue.incに記述されています。

\subsection{data/****/xmlディレクトリ}\label{sec:xml-dir}
xmlディレクトリには入力画面で入力された各科目の情報が学科毎に保存されています。
また、学科毎に科目名・所有教員一覧が記述されたlist.txtも保存されています。

\subsection{data/****/workdirディレクトリ}\label{sec:workd-dir}
xmlディレクトリに格納されたデータを元にtexファイルを作成し、組版する作業ディレクトリです。

\subsection{data/****/pdfディレクトリ}\label{sec:pdf-dir}
生成されたpdfファイルが保存されるディレクトリです。

% XSLTファイル
\section{XSLTファイル}\label{sec:xslt-file}
\subsection{syllabus\_pdf.xsl}\label{sec:syllabus-pdf-xsl}
\ref{sec:xml-dir}章のxmlフォルダに保存されているxmlファイルを、latexで扱えるtexファイルに変換するためのルールを記述しています。

% マニュアルファイル
\section{ユーザーマニュアル}\label{sec:user-manual}
\subsection{user.html}\label{sec:user-html}
シラバスシステムの使用方法を記述しています。

\newpage

%% 文字コード遷移図　※図があるならここにいれようかなと。
%\section{文字コード遷移図}
%シラバスシステムでは、xmlファイルやtexを扱うにあたって、その都度適切な文字コードにエンコードしなければなりません。以下に文字コード遷移図を示します。
%\begin{figure}[htbp]
%\begin{center}
%\includegraphics{root1229883115.pdf}
%\caption{文字コード遷移図}
%\label{fig:mozicode}
%\end{center}
%\end{figure}

% 関数リスト
\section{ユーザ定義関数とその機能、入出力}\label{sec:user-define-function}

\subsection{view\_user\_class.php}
\subsubsection{check\_password(\$password)}
\begin{itemize}
\item 引数

\begin{description}
\item[\$password] 暗号化されたパスワード
\end{description}

\item 機能

ユーザーが入力したパスワードが、シラバスシステムに登録しているパスワードと等しいかチェックします。

\item 戻り値

等しければtrue、等しくなければfalseです。

\end{itemize}

%\subsubsection{makelist()}
%\begin{itemize}

%\item 機能

%\item 戻り値

%\end{itemize}

%\subsubsection{list\_handle(\$depart, \$depart\_ja)}
%\begin{itemize}
%\item 引数
%\begin{description}
%\item[\$depart]
%\item[\$depart\_ja]
%\end{description}

%\item 機能

%\item 戻り値

%\end{itemize}

\subsection{regist\_user.php}

\subsubsection{html\_top()}\label{sec:html-top}
\begin{itemize}

\item 機能

パスワード変更画面のトップページを表示します。

\item 戻り値

ありません。
\end{itemize}

\subsubsection{input\_check()}
\begin{itemize}

\item 機能

パスワード変更画面のトップページで入力されたメールアドレスやパスワードが正しく入力されているか判定します。
もしエラーがある場合は\ref{sec:error}章のerror()関数を呼び出します。
\item 戻り値

ありません。

\end{itemize}

\subsubsection{make\_crypted\_pass()}
\begin{itemize}

\item 機能

ユーザーが入力したパスワードを暗号化し、パスワードを保存しているファイルに書き込みます。

\item 戻り値

ありません。

\end{itemize}

\subsubsection{sorting\_passfile()}
\begin{itemize}
\item 機能

前章で書き込んだパスワード保存ファイルのデータを名前順でソートします。

\item 戻り値

ありません。
\end{itemize}

\subsubsection{html\_out()}
\begin{itemize}

\item 機能

ユーザー登録が正常に行われた後に、登録完了のメッセージと、トップページや科目一覧ページへのリンクを表示します。

\item 戻り値

ありません。

\end{itemize}

\subsubsection{error(\$error\_flag)}\label{sec:error}
\begin{itemize}
\item 引数

\begin{description}
\item[\$error\_flag] ユーザー登録ページで入力された内容にエラーがある場合、
エラー内容に応じたフラグがこの変数にセットされます。
\end{description}

\item 機能

引数の内容からエラー内容を判別し、エラー内容を全て表示します。

\item 戻り値
ありません。
\end{itemize}

\subsection{delete\_user.php}

\subsubsection{delete\_depart(\$depart, \$teacher)}
\begin{itemize}
\item 引数

\begin{description}
\item[\$depart] 教員の学科名
\item[\$teacher]　教員の名前
\end{description}

\item 機能

教員が担当している科目のxml,pdfファイルを削除します。
\item 戻り値

削除したファイルのリスト
\end{itemize}

\subsubsection{make\_teacher\_list()}
\begin{itemize}

\item 機能

削除する教員を選択するためのHTMLを出力します。
\item 戻り値

ありません。
\end{itemize}

\subsection{change\_pass.php}

\subsubsection{html\_top()}
\begin{itemize}

\item 機能

パスワード変更のメイン画面を表示します。
\item 戻り値

ありません。
\end{itemize}

\subsubsection{input\_check()}
\begin{itemize}

\item 機能

パスワード変更のメイン画面で入力されたパスワードが、空白であったり、
入力パスワードと確認用パスワードが違っていればエラー関数を呼び出します。
\item 戻り値

ありません。
\end{itemize}

\subsubsection{make\_crypted\_pass()}
\begin{itemize}

\item 機能

パスワードを保存しているファイルからユーザーの古いパスワードを探し、新しいパスワードに置き換えます。
\item 戻り値

ありません。
\end{itemize}

\subsubsection{html\_out()}
\begin{itemize}

\item 機能

パスワード変更完了メッセージをページを表示します。また、科目一覧ページへのリンクも表示します。
\item 戻り値

ありません。
\end{itemize}

\subsubsection{error(\$error\_flag)}
\begin{itemize}
\item 引数

\begin{description}
\item[\$error\_flag] パスワード変更ページで入力された内容にエラーがある場合、
エラー内容に応じたフラグがこの変数にセットされます。
\end{description}

\item 機能

引数の内容からエラー内容を判別し、エラー内容を全て表示します。また、元のパスワード変更ページへのリンクも表示します。
\item 戻り値

ありません。
\end{itemize}

\subsection{regist\_class.php}

\subsubsection{xml\_ent(\$string)}
\begin{itemize}
\item 引数

\begin{description}
\item[\$string] 登録された科目のxmlファイル名
\end{description}

\item 機能

ファイル名の'(シングルコーテーション)をxmlで扱えるように\&apos; に変換します。(多分)
\item 戻り値

変換後のxmlファイル名です。
\end{itemize}

\subsection{edit.php}

\subsubsection{write()}
\begin{itemize}

\item 機能

ユーザーがシラバスファイルを編集後、その科目のxmlファイルを更新します。
\item 戻り値

ありません。
\end{itemize}

\subsubsection{binarycheck(\$binary)}\label{sec:binarycheck}
\begin{itemize}
\item 引数

\begin{description}
\item[\$binary]　編集画面で入力された値
\end{description}

\item 機能

latexでそのままでは扱えない文字をlatexで扱える形式に、調べてから置き換えます。
\item 戻り値

変換後の値。
\end{itemize}


%\subsubsection{write\_print\_double(\$str)}
%\begin{itemize}
%\item 引数

%\begin{description}
%\item[\$str]
%\end{description}

%\item 機能

%\item 戻り値

%\end{itemize}


\subsubsection{ed()}
\begin{itemize}

\item 機能

ユーザーがシラバスファイルを変更するためのHTMLを出力します。
\item 戻り値

ありません。
\end{itemize}

\subsubsection{changelist(\$name\_ja, \$endtype)}
\begin{itemize}
\item 引数

\begin{description}
\item[\$name\_ja]　講義名
\item[\$endtype]　pdfファイルが完成しているか("complete":完成, "":未完成)
\end{description}

\item 機能

\ref{sec:xml-dir}章のlist.txtファイルを更新します。
\item 戻り値

ありません。
\end{itemize}

\subsubsection{getstate(\$simplefilename, \$depart)}
\begin{itemize}
\item 引数

\begin{description}
\item[\$simplefilename]　編集中のxmlファイル名
\item[\$depart]　学科名
\end{description}

\item 機能

編集中のxmlファイルが承認済みか未承認かを判別します。
\item 戻り値

承認済みなら"complete", 未承認なら"reserve"を返します。
\end{itemize}

%\subsubsection{readvalue\_double(\$tag)}
%\begin{itemize}
%\item 引数

%\begin{description}
%\item[\$tag]
%\end{description}

%\item 機能

%\item 戻り値

%\end{itemize}

\subsubsection{make\_pdf(\$depart, \$simplefilename)}
\begin{itemize}
\item 引数

\begin{description}
\item[\$depart] 学科名
\item[\$simplefilename] 編集中のxmlファイル名
\end{description}

\item 機能

編集を完了したxmlファイルから、pdfファイルを作成します。
\item 戻り値

pdfファイルの作成に成功したら0, 作成に失敗したら1が返されます。
\end{itemize}

\subsubsection{htmlSCU8(\$var)}
\begin{itemize}
\item 引数

\begin{description}
\item[\$var] xmlファイルに格納されている文字コードEUCの情報
\end{description}

\item 機能

EUCコードをutf8の文字コードに変換します。
\item 戻り値

変換後の文字列です。
\end{itemize}

\subsubsection{xml\_ent(\$string)}
\begin{itemize}
\item 引数

\begin{description}
\item[\$string]　binarycheckの引数(\ref{sec:binarycheck})
\end{description}

\item 機能

シングルコーテーション(')をlatexで使えるように、$\&apos;$に変換します。
\item 戻り値

変換後の文字列です。
\end{itemize}

\subsubsection{xml\_ent\_de(\$string)}
\begin{itemize}
\item 引数

\begin{description}
\item[\$string]　入力された講義名（日本語）
\end{description}

\item 機能

講義名に入力されている可能性がある$\&apos;$を探し、$\backslash$' に変換し直します。

\item 戻り値

変換後の文字列です。
\end{itemize}

\subsection{chown\_class.php}

\subsubsection{select\_page(\$selectclass, \$depart)}
\begin{itemize}
\item 引数

\begin{description}
\item[\$selectclass] 所有者を変更したい科目名
\item[\$depart]　学科名
\end{description}

\item 機能

科目の所有教員を決めるトップページを表示します。
\item 戻り値

ありません。
\end{itemize}

\subsubsection{change\_page()}
\begin{itemize}

\item 機能

\ref{sec:xml-dir}章のディレクトリ内にあるlist.txtの内容を更新します。
また、対応するxmlファイルの内容も更新します。
\item 戻り値

ありません。
\end{itemize}

\subsubsection{make\_teacher\_list()}
\begin{itemize}

\item 機能

所有権変更後のHTMLを出力します。
\item 戻り値

ありません。
\end{itemize}

\subsection{str2otf.php}

%\subsubsection{str2otf(\$str)}
%\begin{itemize}
%\item 引数

%\begin{description}
%\item[\$str]
%\end{description}

%\item 機能

%\item 戻り値

%\end{itemize}

%\subsubsection{ordUTF8(\$c, \$index = 0)}
%\begin{itemize}
%\item 引数

%\begin{description}
%\item[\$c]
%\item[\$index = 0]
%\end{description}

%\item 機能

%\item 戻り値

%\end{itemize}


\subsubsection{ChangeFlag(\&\$f)}
\begin{itemize}
\item 引数

\begin{description}
\item[\&\$f] フラグ変数(0:フラグが立っていません, 1:フラグが立っています)
\end{description}

\item 機能

フラグを反転(0ならば1に、1ならば0に)した値を返します。
\item 戻り値

フラグの反転結果です。
\end{itemize}

% 雛形
%\subsubsection{}
%\begin{itemize}
%\item 引数

%\begin{description}
%\item[]
%\end{description}

%\item 機能

%\item 戻り値

%\end{itemize}

\end{document}

%%% END_OF_FILE %%%
